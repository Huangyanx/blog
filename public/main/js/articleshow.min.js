$(document).ready(function(){var g="<div class='tool'><a href='javascript:;' class='Fullscreen' title='全屏'>全屏</a> <a href='javascript:;' class='copyCode' title='复制'>复制</a> </div>";var s="<textarea   id='biao1'></textarea>";if($(".blogitem article pre").get(0)){$(".blogitem article").append(g,s);$(".blogitem article pre").mouseover(function(C){var B=C.srcElement||C.target;var A=$(this).index("pre");var E=this.offsetTop+15;$(".blogitem article .tool").css({top:E,display:"block"}).data("index",A)}).mouseout(function(A){if(!$(A.relatedTarget).hasClass("tool")&&!$(A.relatedTarget).parent().hasClass("tool")){$(".blogitem article .tool").hide()}});$(".Fullscreen").click(function(){var A=window.innerHeight-60;if($(this).data("full")){$($(".blogitem article pre").eq($(this).parent().data("index"))).css({width:"auto",position:"relative","z-index":"",height:"150px",backgroundColor:"transparent"});$("body").height("");$(this).data("full",0)}else{$($(".blogitem article pre").eq($(this).parent().data("index"))).css({width:"98%",height:A,position:"fixed",left:"0",top:0,"z-index":"99",backgroundColor:"#f4ede5"});$("body").height(A);$(this).data("full",1)}});$(".blogitem article .copyCode").click(function(){Url2=$($(".blogitem article pre").eq($(this).parent().data("index"))).html();$("#biao1").val(Url2);$("#biao1").get(0).select();document.execCommand("Copy");alert("复制成功")})}var p=$(".thumbs-up .spot").data("id");var d=localStorage.getItem("head_imgs")||0;var z=false;var j="thumbs-up_zan"+p;var f="thumbs-up_cai"+p;var l=getCookie(j)||0;var i=getCookie(f)||0;if(l==="2"){$(".thumbs-up .zan").addClass("active");$(".thumbs-up .zan i").data("spot",true)}if(i==="2"){$(".thumbs-up .cai").addClass("active");$(".thumbs-up .cai i").data("spot",true)}q();var r=localStorage.getItem("cur_user")||0;if(r){var k=JSON.parse(r);$(".comment-form .headimg_input").val(k.headimg);var b='<img src="'+k.headimg+'" alt="头像">';$(".comment-form .headimg_img").append(b);$(".comment-form .nickname").val(k.nickname);$(".comment-form .email").val(k.email);$(".comment-form .weburl").val(k.weburl);$(".comment-form .userid").val(k.userid)}$(".thumbs-up .zan i").click(function(){n(this,j,"thumbs_up","article")});$(".thumbs-up .cai i").click(function(){n(this,f,"step","article")});function n(E,A,G,C){var B=$(E).next("span").text();var F=$(E).parent().next().data("id");if($(E).data("spot")){B-=1;$(E).parent().removeClass("active");$(E).data("spot",false)}else{B++;$(E).parent().addClass("active");$(E).data("spot",true)}$(E).next("span").text(B);if(A!==""){setCookie(A,0,90,"/main/articleshow")}v(G,B,C,F)}function v(E,B,A,C){if(typeof A==="undefined"){A="article"}if(typeof C==="undefined"||C===""){C=p}$.post("/main/spot",{table:A,id:C,field:E,value:B,action:"changespot"},function(F){if(F.status==1){console.log("点赞成功")}},"json")}$(".choice_img").click(function(B){if(!d){if(!$(this).data("get")){var A=o();m(A);$(this).data("get",true)}}else{if(!$(this).data("get")){m(JSON.parse(d));!$(this).data("get",true)}}$(".head_img_list").slideToggle();B.stopPropagation()});function m(F){var B="";var A=F.length;for(var E=0;E<A;E++){B+="<div class='col-31'> <img src='"+F[E]["url"]+"' data-id='"+F[E]["id"]+"'/><input type='hidden' name='head_imgs[]' value='"+F[E]["url"]+"'></div>"}B+="<div class='clear'></div>";$(".head_img_list").append(B);var C=$(".head_img_list img");if(C){C.bind("click",function(){c(this)})}}function c(B){$(".head_img_list img").removeClass("active");$(B).addClass("active");var A=$(B).attr("src");$(".headimg_input").val(A);$(".comment-form .headimg_img img").attr("src",A)}function y(G,F){var C="";var A=G.length;if(A===0){$(".comment-list ul").append("<p style='text-align: center;'>暂无评论</p>")}for(var B=0;B<A;B++){C+=x(G[B])}$(".comment-list ul").html(C);if(F[0]>1){var E='<div class="comment_page pages"><a class="nextpage" href="javascript:;" data-pages="'+F[0]+'">下一页</a></div>'}else{var E='<div class="comment_page pages">共'+F[1]+"条主评论</div>"}$(".comment-list ").append(E);$(".nextpage").bind("click",function(){w(2,0,".comment-list",true)})}function a(K){var E="<ul class='sec_pl'>";var C=K.length;for(var B=0;B<C;B++){var J=K[B]["headimg"];var A=K[B]["weburl"]===""?"javascript:void(0);":K[B]["weburl"];var F=K[B]["posttime"];var G=u(F);E+="<li class='comment_one comment_one_"+K[B]["id"]+"'><div class='img'><img src='"+J+"'></div><div class='comment_text'><div class='main'><div class='userinfos'><strong><a href='"+A+"' target='_blank'> "+K[B]["nickname"]+"</a></strong><span class='comment_time'>"+G+"</span></div><div class='txt'>"+K[B]["content"]+"</div><div class='spot'><span class='replay_list' data-id='"+K[B]["id"]+"'>回复- <i>"+K[B]["comment_nums"]+"</i></span> <i class='iconfont icon-zan-empay zan' title='点赞'></i><span>"+K[B]["thumbs_up"]+"</span><i class='iconfont icon-cai cai' title='踩'></i><span>"+K[B]["step"]+"</span></div><div class='comment_btn' data-nickname='"+K[B]["nickname"]+"' data-id='"+K[B]["id"]+"'>回复</div></div> </div><div class='clear'></div>";E+="</li>"}E+="</ul>";return E}$(".comment-form .form-submit").click(function(){if(!z){var F=$(".comment-form .content").val();var A=$(".comment-form .nickname").val();var C=$(".comment-form .email").val();var E=$(".comment-form input[name='replayid']").val();if(F===""&&A===""&&C===""){alert("请填写完整信息！")}else{if(e(C)){var B=$(".comment-form").serialize();B+="&action=add&table=1&tid="+p;z=true;$.post("/main/comment",B,function(L){z=false;if(L.status==2){var O=L.data;alert("评论成功");$(".comment-form .content").val("");var K={};K.userid=O.userid;K.headimg=O.headimg;K.nickname=A;K.weburl=$(".comment-form .weburl").val();K.email=C;var N=JSON.stringify(K);localStorage.setItem("cur_user",N);$(".headimg_input").val(O.headimg);if(E!==0&&E!=="0"){var J='<ul class="sec_pl">';J+=x(O);J+="</ul>";$(".comment_one_"+E).append(J)}else{var J=x(O);$(".comment-list ul").prepend(J)}var G=$("h2.title").text();var P="action=sendmail&curarticle="+G+"&comment_id="+O.id;$.post("/main/comment",P,function(Q){if(Q.status){console.log(Q.msg)}},"json")}else{if(L.status==3){alert(L.msg)}}},"json")}else{alert("邮箱格式不正确！")}}}});function o(){$.post("/main/spot",{action:"getheadimg"},function(B){if(B.status==2){var C=B.data;var A=JSON.stringify(C);d=A;localStorage.setItem("head_imgs",A);return C}},"json")}function e(B){var A=/^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;if(!A.exec(B)){return false}return true}function h(C,A){var B=$(".comment_wrap").offset().top;$("body,html").animate({scrollTop:B},1000);$(".comment-form .replayid").show();$(".comment-form .replayid .nickname_p").text(A);$(".comment-form .replayid input").val(C)}function q(B){var A={};A.action="list";A.tid=p;A.tableid=1;if(typeof(B)!=="undefined"||B!==""||B!==undefined){A.page=B}$.post("/main/comment",A,function(C){if(C.status==2){console.log(C);y(C.data,C.pagelist)}},"json")}function u(B){var A=new Date(B*1000+28800);Y=A.getFullYear()+"-";M=(A.getMonth()+1<10?"0"+(A.getMonth()+1):A.getMonth()+1)+"-";D=A.getDate()+" ";H=A.getHours()+":";I=A.getMinutes()+":";S=A.getSeconds()+" ";return Y+M+D+H+I+S}function t(C,G,F,B){if(typeof F==="undefined"){F=1}var A=F+1;var E={};E.action="list";E.tid=p;E.tableid=1;E.rid=C;E.page=F;$.post("/main/comment",E,function(P){if(P.status==2){var Q=P.pagelist;if(B){var O="";var K=P.data.length;for(var L=0;L<K;L++){O+=x(P.data[L])}$(G).append(O);var N=$(G)}else{var O=a(P.data);$(G).data("has_req",true);$(G).parents("li:eq(0)").append(O);var N=$(G).parents("li:eq(0)")}if(Q[0]>F){var J='<div class="comment_page"><a class="nextpage_'+C+'" href="javascript:;"  data-pages="'+Q[0]+'">下一页</a></div>'}else{if(Q[0]===F){var J='<div class="comment_page ">最后一页</div>'}}N.remove(".comment_page");N.append(J);$(".nextpage_"+C).bind("click",function(){w(A,C,G,false)})}},"json")}$(document).on("click",".comment-list .comment_btn",function(){h($(this).data("id"),$(this).data("nickname"))});$(document).on("click",".spot .zan",function(){n(this,"","thumbs_up","comment")});$(document).on("click",".spot .cai",function(){n(this,"","step","comment")});$(document).on("click",".replay_list",function(){if($(this).data("has_req")&&$(this).find("i").text()>0){$(this).parents("li:eq(0)").find(".sec_pl:eq(0)").slideToggle()}else{if(!$(this).data("has_req")&&$(this).find("i").text()>0){t($(this).data("id"),this)}}});function w(C,B,E,A){if(typeof B==="undefined"){B=0}if(typeof E==="undefined"){E=".comment-list"}t(B,E,C,A)}function x(J){var C="";var G=J.headimg;var B=J.weburl===""?"javascript:void(0);":J.weburl;var E=J.posttime;var F=u(E);var A=typeof J.comment_nums==="undefined"?0:J.comment_nums;C+="<li class='comment_one comment_one_"+J.id+" '  ><div class='img'><img src='"+G+"'></div><div class='comment_text'><div class='main'><div class='userinfos'><strong><a href='"+B+"' target='_blank'> "+J.nickname+"</a></strong><span class='comment_time'>"+F+"</span></div><div class='txt'>"+J.content+"</div><div class='spot'><span class='replay_list' data-id='"+J.id+"'>回复- <i>"+A+"</i></span> <i class='iconfont icon-zan-empay zan' title='点赞'></i><span>"+J.thumbs_up+"</span><i class='iconfont icon-cai cai' title='点赞'></i><span>"+J.step+"</span></div><div class='comment_btn' data-nickname='"+J.nickname+"' data-id='"+J.id+"'> 回复 </div> </div> </div><div class='clear'></div>";return C}});
